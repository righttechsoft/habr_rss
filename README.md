# Habr RSS Reader

RSS-читалка для статей Habr с AI-резюме.

## Возможности

- **Обработка RSS-ленты**: Автоматически получает и обрабатывает статьи Habr
- **AI-резюме**: Генерирует краткие резюме с помощью Mistral AI (опционально)
- **Веб-интерфейс**: Чистый, адаптивный веб-интерфейс для чтения статей
- **База данных SQLite**: Постоянное хранение с автоматическим управлением схемой
- **Готово к Docker**: Полностью контейнеризовано с автоматическим планированием

## Требования

### Deno
Для работы приложения требуется Deno версии 1.46.3 или выше.

Установить Deno можно с официального сайта: [https://deno.land/](https://deno.land/)

## Быстрый старт

### Запуск в Windows

Для удобства запуска в Windows предусмотрены готовые bat-файлы:

1. **Загрузка статей**:
   ```cmd
   fetch.bat
   ```

2. **Генерация AI-резюме** (опционально):
   ```cmd
   # Установите переменную окружения перед запуском
   set MISTRAL_API_KEY=your_mistral_api_key_here
   # Затем запустите файл, который уже содержит команду ai_summary.ts
   ```

3. **Запуск веб-интерфейса**:
   ```cmd
   view.bat
   ```

### Ручной запуск

```bash
# Загрузка статей
deno run --allow-net --allow-read --allow-write fetch_articles.ts

# Генерация AI-резюме (опционально)
export MISTRAL_API_KEY="your_key_here"
deno run --allow-net --allow-read --allow-write --allow-env ai_summary.ts

# Запуск веб-интерфейса
deno run --allow-net --allow-read --allow-write viewer.ts
```

### Использование Docker

```bash
# Сборка образа
docker build -t habr-rss .

# Запуск контейнера
docker run -d \
  -p 8000:8000 \
  -v $(pwd)/db:/app/db \
  -v $(pwd)/logs:/var/log \
  -e MISTRAL_API_KEY="your_key_here" \
  -e HEALTHCHECK_URL="your_healthcheck_url_here" \
  --name habr-rss \
  habr-rss
```

После запуска откройте http://localhost:8000 в браузере.

## Конфигурация

### Переменные окружения

- `MISTRAL_API_KEY`: API-ключ для Mistral AI (опционально, требуется для AI-резюме)
- `PORT`: Порт веб-сервера (по умолчанию: 8000)
- `HEALTHCHECK_URL`: URL для отправки healthcheck-пингов после успешного выполнения задач (опционально)

### Docker Volumes

- `./db:/app/db`: Постоянство базы данных SQLite
- `./logs:/var/log`: Логи приложения

## Архитектура

- **fetch_articles.ts**: Обработчик RSS-ленты (запускается каждый час в Docker)
- **ai_summary.ts**: Генератор AI-резюме (запускается каждый час в Docker, опционально)
- **viewer.ts**: Сервер веб-приложения
- **База данных SQLite**: Хранение статей с состоянием просмотра и AI-резюме

## Опциональные Healthcheck-уведомления

Приложение поддерживает отправку healthcheck-пингов после успешного выполнения задач. Это полезно для мониторинга работы приложения с помощью сервисов типа Healthchecks.io или UptimeRobot.

Чтобы включить healthcheck-уведомления:

1. Установите переменную окружения `HEALTHCHECK_URL` с URL вашего healthcheck-сервиса
2. После успешного завершения загрузки статей приложение автоматически отправит GET-запрос на указанный URL

Если переменная `HEALTHCHECK_URL` не установлена, healthcheck-уведомления отправляться не будут.

## Автоматическое расписание (Docker)

Docker-контейнер автоматически:
- Загружает новые статьи каждый час
- Генерирует AI-резюме для новых статей (если предоставлен API-ключ)
- Поддерживает веб-интерфейс непрерывно
- Ведет логи всех операций

## Логи

Просмотр логов приложения:

```bash
# Docker
docker logs -f habr-rss

# Файлы логов (если примонтированы)
tail -f logs/viewer.log
tail -f logs/hourly_tasks.log
```

## Health Check

Контейнер включает проверку работоспособности, которая проверяет отклик веб-интерфейса:
```bash
curl http://localhost:8000/
```